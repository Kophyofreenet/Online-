<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online Users Status List</title>
    <style>
        :root {
            --bg-primary: #f8f9fa;
            --bg-secondary: #fff;
            --text-primary: #333;
            --text-secondary: #2c3e50;
            --border-color: #e0e0e0;
            --table-header-bg: linear-gradient(to bottom, #3498db, #2980b9);
            --table-row-even: #f8f9fa;
            --table-row-hover: #e8f4fc;
            --total-users-bg: linear-gradient(to right, #3498db, #2c3e50);
            --progress-low: #2ecc71;
            --progress-medium: #f39c12;
            --progress-high: #e74c3c;
        }

        .dark-mode {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --text-primary: #e0e0e0;
            --text-secondary: #f0f0f0;
            --border-color: #444;
            --table-header-bg: linear-gradient(to bottom, #2c3e50, #1a2a3e);
            --table-row-even: #363636;
            --table-row-hover: #3a4a5c;
            --total-users-bg: linear-gradient(to right, #2c3e50, #1a2a3e);
            --progress-low: #27ae60;
            --progress-medium: #d35400;
            --progress-high: #c0392b;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 10px;
            min-height: 100vh;
            color: var(--text-primary);
            background-color: var(--bg-primary);
            transition: background-color 0.3s, color 0.3s;
            position: relative;
            padding-bottom: 60px;
        }
        .container {
            max-width: 100%;
            margin: 0 auto;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            padding: 15px;
            background-color: var(--bg-secondary);
            overflow: hidden;
        }
        
        /* Header with logo and title */
        .header {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
            flex-direction: column;
            text-align: center;
        }
        .logo {
            width: 50px;
            height: 50px;
            margin-right: 0;
            margin-bottom: 10px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        .logo img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }
        h1 {
            color: var(--text-secondary);
            margin: 0;
            font-size: 1.5em;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        /* 3D Running Text */
        .marquee-container {
            overflow: hidden;
            background: rgba(52, 152, 219, 0.1);
            border-radius: 8px;
            padding: 8px;
            margin: 15px 0;
            border: 1px solid rgba(52, 152, 219, 0.2);
        }
        .marquee {
            font-size: 1em;
            font-weight: bold;
            color: #3498db;
            text-shadow: 
                0 1px 0 #ccc, 
                0 2px 0 #c9c9c9;
            white-space: nowrap;
            animation: marquee 20s linear infinite;
        }
        @keyframes marquee {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background-color: var(--bg-secondary);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            border-radius: 8px;
            overflow: hidden;
            margin: 15px 0;
            font-size: 0.85em;
        }
        th, td {
            border: 1px solid var(--border-color);
            padding: 12px 8px;
            text-align: left;
        }
        th {
            background: var(--table-header-bg);
            color: white;
            font-weight: bold;
            text-align: center;
            font-size: 0.9em;
            padding: 10px 5px;
        }
        tr:nth-child(even) {
            background-color: var(--table-row-even);
        }
        tr:hover {
            background-color: var(--table-row-hover);
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 6px;
        }
        .status-online {
            background-color: #2ecc71;
            box-shadow: 0 0 8px #2ecc71;
        }
        .status-offline {
            background-color: #e74c3c;
            box-shadow: 0 0 8px #e74c3c;
        }
        .online-count {
            color: #2ecc71;
            font-weight: bold;
            font-size: 1em;
        }
        .ping-time {
            font-size: 0.85em;
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 15px;
            display: inline-block;
        }
        .ping-good {
            background-color: #e8f6ef;
            color: #2ecc71;
        }
        .ping-medium {
            background-color: #fef9e7;
            color: #f1c40f;
        }
        .ping-bad {
            background-color: #fbebee;
            color: #e74c3c;
        }
        .total-users {
            text-align: center;
            margin-top: 20px;
            font-weight: bold;
            font-size: 1.1em;
            padding: 15px;
            background: var(--total-users-bg);
            color: white;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }
        .server-name {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
        }
        .flag {
            width: 24px;
            height: 18px;
            border: 1px solid #ddd;
            box-shadow: 0 0 3px rgba(0, 0, 0, 0.1);
            border-radius: 2px;
            object-fit: cover;
        }
        .refresh-info {
            text-align: center;
            margin: 12px 0;
            color: #7f8c8d;
            font-size: 0.85em;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        .last-updated {
            text-align: center;
            color: #7f8c8d;
            font-size: 0.8em;
            margin-top: 10px;
        }
        .theme-toggle {
            position: fixed;
            bottom: 15px;
            right: 15px;
            background: linear-gradient(135deg, #3498db, #2c3e50);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            z-index: 1000;
        }
        .theme-toggle:hover {
            transform: scale(1.1) rotate(30deg);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        .copyright {
            text-align: center;
            margin-top: 15px;
            color: #7f8c8d;
            font-size: 0.8em;
            padding: 8px;
        }
        
        /* New styles for user limit and progress */
        .user-limit {
            font-weight: bold;
            margin-bottom: 4px;
            font-size: 0.9em;
        }
        .progress-container {
            width: 100%;
            background-color: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            height: 8px;
            margin-top: 4px;
        }
        .dark-mode .progress-container {
            background-color: #444;
        }
        .progress-bar {
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        .progress-low {
            background-color: var(--progress-low);
        }
        .progress-medium {
            background-color: var(--progress-medium);
        }
        .progress-high {
            background-color: var(--progress-high);
        }
        .progress-text {
            font-size: 0.8em;
            margin-top: 3px;
            text-align: right;
            font-weight: bold;
        }
        .capacity-good {
            color: var(--progress-low);
        }
        .capacity-busy {
            color: var(--progress-medium);
        }
        .capacity-high {
            color: var(--progress-high);
        }
        .capacity-full {
            color: var(--progress-high);
        }
        
        /* Mobile-specific styles */
        .mobile-card {
            display: none;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 8px;
            }
            .container {
                padding: 12px;
                border-radius: 10px;
            }
            table {
                display: none;
            }
            .mobile-card {
                display: block;
                margin-bottom: 10px;
                padding: 12px;
                border-radius: 8px;
                background-color: var(--bg-secondary);
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
                border: 1px solid var(--border-color);
            }
            .card-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 10px;
                padding-bottom: 8px;
                border-bottom: 1px solid var(--border-color);
            }
            .server-status {
                display: flex;
                align-items: center;
                font-weight: bold;
            }
            .server-name-mobile {
                display: flex;
                align-items: center;
                gap: 8px;
                font-weight: 600;
            }
            .card-content {
                margin-bottom: 10px;
            }
            .card-footer {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding-top: 8px;
                border-top: 1px solid var(--border-color);
            }
            h1 {
                font-size: 1.3em;
            }
            .marquee {
                font-size: 0.9em;
            }
            .theme-toggle {
                bottom: 10px;
                right: 10px;
                width: 45px;
                height: 45px;
                font-size: 1.3rem;
            }
        }
        
        @media (max-width: 480px) {
            th, td {
                padding: 10px 5px;
                font-size: 0.8em;
            }
            .server-name {
                flex-direction: row;
                align-items: center;
                gap: 5px;
            }
            h1 {
                font-size: 1.2em;
            }
            .marquee {
                font-size: 0.8em;
            }
            .theme-toggle {
                bottom: 8px;
                right: 8px;
                width: 40px;
                height: 40px;
                font-size: 1.1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">
                <img src="https://raw.githubusercontent.com/Kophyofreenet/MMT-Premium/refs/heads/main/IMG_20251107_153923_973.jpg" alt="PhyoeVPN Logo">
            </div>
            <h1>Servers List: Online Users</h1>
        </div>
        
        <div class="marquee-container">
            <div class="marquee">
                üôè·Äô·ÄÇ·Ä∫·Äú·Ä¨·Äï·Ä´·ÄÅ·ÄÑ·Ä∫·Äó·Äª·Ä¨·Ä∏üôèùêèùê°ùê≤ùê®ùêû ùêïùêèùêç·Ä°·Äû·ÄØ·Ä∂·Ä∏·Äï·Äº·ÄØ·ÄÄ·Äº·Äê·Ä≤·Ä∑·Ää·ÄÆ·Ä°·ÄÄ·Ä≠·ÄØ·Äô·Äª·Ä¨·Ä∏·Äõ·ÄΩ·Äæ·ÄÑ·Ä∫·Äú·Äî·Ä∫·Ä∏·ÄÅ·Äª·Äô·Ä∫·Ä∏·Äô·Äº·Ä±·Ä∑·ÄÄ·Äº·Äï·Ä´·ÄÖ·Ä±üôè·Äë·Ä≠·ÄØ·ÄÑ·Ä∫·Ä∏·Ä°·ÄÑ·Ä∫·Äê·Ä¨·Äî·ÄÄ·Ä∫·ÄÄ·Ä≠·ÄØ·Ä°·ÄÄ·ÄØ·Äî·Ä∫·Ä°·ÄÄ·Äº·Äû·ÄÄ·Ä∫·Äû·Ä¨·Äñ·Ä≠·ÄØ·Ä∑ùêèùê°ùê≤ùê®ùêû ùêïùêèùêç·ÄÄ·Ä≠·ÄØ·Äï·Äº·ÄØ·Äú·ÄØ·Äï·Ä∫·Äë·Ä¨·Ä∏·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏·Äñ·Äº·ÄÖ·Ä∫·Äï·Ä´·Äê·Äö·Ä∫·Äó·Äª·Ä¨·Ä∑üôè
            </div>
        </div>
        
        <div class="refresh-info">üñ•Ô∏è ·Äú·Ä∞·Äû·ÄØ·Ä∂·Ä∏·Äî·Ää·Ä∫·Ä∏·Äê·Ä≤·Ä∑·ÄÜ·Ä¨·Äó·Ä¨·Äê·ÄΩ·Ä±·Äõ·ÄΩ·Ä±·Ä∏·ÄÅ·Äª·Äö·Ä∫·Äï·Äº·ÄÆ·Ä∏·Äû·ÄØ·Ä∂·Ä∏·Äï·Ä´</div>
        
        <?php
        // Function to get day of week and set background
        function getDayOfWeekBackground() {
            $dayOfWeek = date('w'); // 0 (Sunday) to 6 (Saturday)
            
            $gradients = [
                "linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d)", // Sunday
                "linear-gradient(135deg, #00416A, #E4E5E6)",           // Monday
                "linear-gradient(135deg, #000046, #1CB5E0)",           // Tuesday
                "linear-gradient(135deg, #36D1DC, #5B86E5)",           // Wednesday
                "linear-gradient(135deg, #348F50, #56B4D3)",           // Thursday
                "linear-gradient(135deg, #5614B0, #DBD65C)",           // Friday
                "linear-gradient(135deg, #C33764, #1D2671)"            // Saturday
            ];
            
            return $gradients[$dayOfWeek];
        }
        
        // Set body background based on day of week
        echo '<style>body { background: ' . getDayOfWeekBackground() . '; }</style>';
        
        // Function to get country code from server name
        function getCountryCode($serverName) {
            $parts = explode('-', $serverName);
            return isset($parts[0]) ? $parts[0] : '';
        }
        
        // Function to get flag image based on country code
        function getFlagImage($countryCode) {
            $countryCode = strtolower($countryCode);
            $flagPath = "https://flagcdn.com/w40/{$countryCode}.png";
            return "<img src='{$flagPath}' alt='{$countryCode} flag' class='flag' onerror='this.style.display=\"none\"'>";
        }
        
        // Function to determine ping class
        function getPingClass($pingTime) {
            if ($pingTime <= 100) return 'ping-good';
            if ($pingTime <= 300) return 'ping-medium';
            return 'ping-bad';
        }

        // Function to get progress bar class based on percentage
        function getProgressClass($percentage) {
            if ($percentage <= 50) return 'progress-low';
            if ($percentage <= 80) return 'progress-medium';
            return 'progress-high';
        }
        
        // Function to get capacity text and class based on percentage
        function getCapacityStatus($percentage) {
            if ($percentage < 100) {
                if ($percentage <= 50) {
                    return ['text' => 'Good', 'class' => 'capacity-good'];
                } else if ($percentage <= 80) {
                    return ['text' => 'Busy', 'class' => 'capacity-busy'];
                } else {
                    return ['text' => 'High-Load', 'class' => 'capacity-high'];
                }
            } else {
                return ['text' => 'Full', 'class' => 'capacity-full'];
            }
        }

        // Server list with names and URLs
        $servers = [
            'th-Free Server 001' => 'http://103.114.200.252:81/server/online',
            'th-Free Server 001' => 'http://103.114.200.251:81/server/online',
            'th-Free Server 002' => 'http://103.114.200.252:81/server/online',
            'th-Free Server 003' => 'http://185.78.167.193:81/server/online'
           
          
          
        ];

        $totalOnlineCount = 0;
        $totalCapacity = count($servers) * 250; // Total capacity across all servers

        echo '<table>';
        echo '<tr><th>Server Status</th><th>Server Name</th><th>Online Users</th><th>Ping</th></tr>';

        // Mobile cards container
        echo '<div class="mobile-cards-container">';

        foreach ($servers as $serverName => $serverURL) {
            // Initialize variables
            $onlineCount = 0;
            $pingTime = 0;
            $statusClass = 'status-offline';
            $statusText = 'Offline';
            $errorMessage = '';
            
            // Get country code and flag
            $countryCode = getCountryCode($serverName);
            $flagImg = $countryCode ? getFlagImage($countryCode) : '';
            
            // Start time measurement for ping
            $startTime = microtime(true);
            
            // Try to get server response with timeout
            $context = stream_context_create(['http' => ['timeout' => 5]]);
            $response = @file_get_contents($serverURL, false, $context);
            
            // Calculate ping time
            $pingTime = round((microtime(true) - $startTime) * 1000); // Convert to milliseconds
            
            if ($response !== false) {
                $onlineCount = intval($response);
                $statusClass = 'status-online';
                $statusText = 'Online';
                $totalOnlineCount += $onlineCount;
                
                $pingClass = getPingClass($pingTime);
                
                // Calculate percentage of server capacity used
                $percentage = ($onlineCount / 250) * 100;
                $progressClass = getProgressClass($percentage);
                
                // Get capacity status text and class
                $capacityStatus = getCapacityStatus($percentage);
                $capacityText = $capacityStatus['text'];
                $capacityClass = $capacityStatus['class'];
                
                echo "<tr>
                        <td><span class='status-indicator $statusClass'></span>$statusText</td>
                        <td class='server-name'>$flagImg <span>" . strtoupper($serverName) . "</span></td>
                        <td>
                            <div class='user-limit'>Active: <span class='online-count'>$onlineCount</span>/250 Users</div>
                            <div class='progress-container'>
                                <div class='progress-bar $progressClass' style='width: $percentage%'></div>
                            </div>
                            <div class='progress-text $capacityClass'>" . round($percentage, 1) . "% - $capacityText</div>
                        </td>
                        <td><span class='ping-time $pingClass'>" . $pingTime . " ms</span></td>
                      </tr>";
                
                // Mobile card
                echo "<div class='mobile-card'>
                        <div class='card-header'>
                            <div class='server-status'><span class='status-indicator $statusClass'></span>$statusText</div>
                            <div class='server-name-mobile'>$flagImg <span>" . strtoupper($serverName) . "</span></div>
                        </div>
                        <div class='card-content'>
                            <div class='user-limit'>Active: <span class='online-count'>$onlineCount</span>/250 Users</div>
                            <div class='progress-container'>
                                <div class='progress-bar $progressClass' style='width: $percentage%'></div>
                            </div>
                            <div class='progress-text $capacityClass'>" . round($percentage, 1) . "% - $capacityText</div>
                        </div>
                        <div class='card-footer'>
                            <div>Ping: <span class='ping-time $pingClass'>" . $pingTime . " ms</span></div>
                        </div>
                      </div>";
            } else {
                $error = error_get_last();
                $errorMessage = isset($error['message']) ? $error['message'] : 'Unknown error';
                
                echo "<tr>
                        <td><span class='status-indicator $statusClass'></span>$statusText</td>
                        <td class='server-name'>$flagImg <span>" . strtoupper($serverName) . "</span></td>
                        <td>
                            <div class='user-limit'>Active: <span class='online-count'>0</span>/250 Users</div>
                            <div class='progress-container'>
                                <div class='progress-bar' style='width: 0%'></div>
                            </div>
                            <div class='progress-text'>0% - Offline</div>
                        </td>
                        <td><span class='ping-time'>" . $pingTime . " ms</span></td>
                      </tr>";
                
                // Mobile card for offline server
                echo "<div class='mobile-card'>
                        <div class='card-header'>
                            <div class='server-status'><span class='status-indicator $statusClass'></span>$statusText</div>
                            <div class='server-name-mobile'>$flagImg <span>" . strtoupper($serverName) . "</span></div>
                        </div>
                        <div class='card-content'>
                            <div class='user-limit'>Active: <span class='online-count'>0</span>/250 Users</div>
                            <div class='progress-container'>
                                <div class='progress-bar' style='width: 0%'></div>
                            </div>
                            <div class='progress-text'>0% - Offline</div>
                        </div>
                        <div class='card-footer'>
                            <div>Ping: <span class='ping-time'>" . $pingTime . " ms</span></div>
                        </div>
                      </div>";
            }
        }

        echo '</table>';
        echo '</div>'; // Close mobile-cards-container
        
        // Calculate total usage percentage
        $totalPercentage = $totalCapacity > 0 ? ($totalOnlineCount / $totalCapacity) * 100 : 0;
        $totalProgressClass = getProgressClass($totalPercentage);
        $totalCapacityStatus = getCapacityStatus($totalPercentage);
        $totalCapacityText = $totalCapacityStatus['text'];
        $totalCapacityClass = $totalCapacityStatus['class'];
        
        echo "<div class='total-users'>
                Total Online Active: <span class='online-count'>$totalOnlineCount</span>/$totalCapacity Users
                <div class='progress-container' style='margin: 10px auto; max-width: 300px;'>
                    <div class='progress-bar $totalProgressClass' style='width: $totalPercentage%'></div>
                </div>
                <div class='$totalCapacityClass'>Overall Capacity: " . round($totalPercentage, 1) . "% - $totalCapacityText</div>
              </div>";
        
        date_default_timezone_set('Asia/Bangkok');
        echo "<div class='last-updated'>Last updated: " . date('Y-m-d H:i:s') . "</div>";
        
        // Copyright notice
        echo "<div class='copyright'>¬© 2023 Server Status Monitor. All rights reserved.</div>";
        ?>
    </div>

    <button class="theme-toggle" id="themeToggle">üåô</button>

    <script>
        // Theme toggle functionality
        const themeToggle = document.getElementById('themeToggle');
        const body = document.body;
        
        // Check for saved theme preference or respect OS preference
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
            body.classList.toggle('dark-mode', savedTheme === 'dark');
            updateToggleButton();
        } else {
            // Default to OS preference if no saved preference
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            body.classList.toggle('dark-mode', prefersDark);
            localStorage.setItem('theme', prefersDark ? 'dark' : 'light');
            updateToggleButton();
        }
        
        // Toggle theme on button click
        themeToggle.addEventListener('click', () => {
            body.classList.toggle('dark-mode');
            const isDark = body.classList.contains('dark-mode');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            updateToggleButton();
        });
        
        // Update toggle button icon
        function updateToggleButton() {
            themeToggle.textContent = body.classList.contains('dark-mode') ? '‚òÄÔ∏è' : 'üåô';
        }
        
        // Function to update ping times
        function updatePingTimes() {
            console.log("Updating ping times...");
            // In a real implementation, this would ma
